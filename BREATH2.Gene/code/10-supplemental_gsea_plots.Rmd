---
title: "10-supplemental_gsea_plots"
output: html_notebook
toc: true
---

```{r}
#| warning: false


library(clusterProfiler)
library(msigdbr)
library(org.Hs.eg.db)
library(dplyr)
library(ggplot2)
library(stringr)
library(enrichplot)






# 10.1. Import data


data_dir <- "C:/Users/User/Documents/UCSF/BREATH2.Gene/data"
results_dir <- "C:/Users/User/Documents/UCSF/BREATH2.Gene/results"

rna_res <- read.csv(
  file.path(results_dir, "DE_limma_results_transcriptome.csv"),
  stringsAsFactors=F)

# Use gene symbols and log2FC
gsea_df <- rna_res %>%
  filter(!is.na(gene_symbol)) %>%
  distinct(gene_symbol, .keep_all=T)

# Named numeric vector: log2FC, names = gene symbols
gene_ranks <- gsea_df$log2FoldChange
names(gene_ranks) <- gsea_df$gene_symbol

# Sort decreasing
gene_ranks <- sort(gene_ranks, decreasing=T)

hallmark_sets <- msigdbr(
  species  = "Homo sapiens",
  category = "H"
) %>%
  dplyr::select(gs_name, gene_symbol)

gsea_hallmark <- GSEA(
  geneList     = gene_ranks,
  TERM2GENE    = hallmark_sets,
  pvalueCutoff = 0.05,
  eps          = 0,
  verbose      = FALSE
)






# 10.2. Hallmark IL6 JAK STAT3 Signaling


p_il6_jak <- gseaplot2(
  gsea_hallmark,
  geneSetID = "HALLMARK_IL6_JAK_STAT3_SIGNALING",
  title = "Hallmark IL6 JAK STAT3 Signaling",
  base_size = 12,
  subplots = c(1, 2, 3))

p_il6_jak

ggsave(
  file.path(results_dir, "GSEA_Hallmark_IL6_JAK_STAT3.png"),
  plot = p_il6_jak,
  width = 7,
  height = 6,
  dpi = 300
)







# 10.3. Hallmark Inflammatory Response


p_inflam <- gseaplot2(
  gsea_hallmark,
  geneSetID = "HALLMARK_INFLAMMATORY_RESPONSE",
  title = "Hallmark Inflammatory Response",
  base_size = 12,
  subplots = c(1, 2, 3))

p_inflam

ggsave(
  file.path(results_dir, "GSEA_Hallmark_Inflammatory_Response.png"),
  plot = p_inflam,
  width = 7,
  height = 6,
  dpi = 300
)






# 10.4. Hallmark Allograft Rejection


p_allograft <- gseaplot2(
  gsea_hallmark,
  geneSetID = "HALLMARK_ALLOGRAFT_REJECTION",
  title = "Hallmark Allograft Rejection",
  base_size = 12,
  subplots = c(1, 2, 3))

p_allograft

ggsave(
  file.path(results_dir, "GSEA_Hallmark_Allograft_Rejection.png"),
  plot = p_allograft,
  width = 7,
  height = 6,
  dpi = 300
)






# 10.5. Hallmark TNFA Signaling via NFKB


p_tnfa_nfkb <- gseaplot2(
  gsea_hallmark,
  geneSetID = "HALLMARK_TNFA_SIGNALING_VIA_NFKB",
  title = "Hallmark TNFA Signaling via NFKB",
  base_size = 12,
  subplots = c(1, 2, 3))

p_tnfa_nfkb

ggsave(
  file.path(results_dir, "GSEA_Hallmark_TNFA_NFKB.png"),
  plot = p_tnfa_nfkb,
  width = 7,
  height = 6,
  dpi = 300
)






# 10.6. Hallmark Apoptosis


p_apoptosis <- gseaplot2(
  gsea_hallmark,
  geneSetID = "HALLMARK_APOPTOSIS",
  title = "Hallmark Apoptosis",
  base_size = 12,
  subplots = c(1, 2, 3))

p_apoptosis

ggsave(
  file.path(results_dir, "GSEA_Hallmark_Apoptosis.png"),
  plot = p_apoptosis,
  width = 7,
  height = 6,
  dpi = 300
)






# 10.7. Hallmark IL2 STAT5 Signaling


p_il2_stat5 <- gseaplot2(
  gsea_hallmark,
  geneSetID = "HALLMARK_IL2_STAT5_SIGNALING",
  title = "Hallmark IL2 STAT5 Signaling",
  base_size = 12,
  subplots = c(1, 2, 3))

p_il2_stat5

ggsave(
  file.path(results_dir, "GSEA_Hallmark_IL2_STAT5.png"),
  plot = p_il2_stat5,
  width = 7,
  height = 6,
  dpi = 300
)






# 10.8. Hallmark Complement


p_complement <- gseaplot2(
  gsea_hallmark,
  geneSetID = "HALLMARK_COMPLEMENT",
  title = "Hallmark Complement",
  base_size = 12,
  subplots = c(1, 2, 3))
  
p_complement

ggsave(
  file.path(results_dir, "GSEA_Hallmark_Complement.png"),
  plot = p_complement,
  width = 7,
  height = 6,
  dpi = 300
)






```