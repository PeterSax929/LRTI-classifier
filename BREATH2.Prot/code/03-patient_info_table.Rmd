---
title: "03-patient_info_table"
output: html_notebook
toc: true
---

```{r}
#| warning: false






# 3.1. Subset both datasets to Definite/No Evidence


# Set file paths
data_dir <- "C:/Users/User/Documents/UCSF/BREATH2.Prot/data"

# Read csvs
protein_lookup_table <- read.csv( 
          file.path(data_dir, "protein_lookup_table.csv"),
          stringsAsFactors=F)

protein_mat_ALL <- read.csv( 
          file.path(data_dir, "protein_mat_ALL.csv"), 
          stringsAsFactors=F, row.names=1)

# Include only Definite and No Evidence patients
patient_info <- patient_info_ALL[patient_info_ALL$LRTI_adjudication %in% 
                                     c("Definite", "No Evidence"), ]

# Includes only the protein matrix for Definite and No Evidence patients
protein_mat <- protein_mat_ALL[match(patient_info$patient_id, 
                                       rownames(protein_mat_ALL)), ]

# Save outputs
write.csv(patient_info, 
          file.path(data_dir, "patient_info.csv"),
          row.names=F)

write.csv(protein_mat,
          file.path(data_dir, "protein_mat.csv"),
          row.names=T)






# 3.2. Define Workflow Parameters


# Define parameters
Definite <- table(patient_info$LRTI_adjudication)["Definite"]
No_Evidence <- table(patient_info$LRTI_adjudication)["No Evidence"]
npatients <- nrow(patient_info)
nproteins <- ncol(protein_mat)
nfolds <- 5
ntrees <- 10000

# Store parameters as data frame
Parameters <- data.frame(c(npatients, Definite, No_Evidence, nproteins, nfolds, ntrees))
row.names(Parameters) = c("Patients", "Definite", "No Evidence", "Proteins", "Folds", "RF Trees")
colnames(Parameters) = "Count"

# Write csv
write.csv(Parameters, 
          file.path(data_dir, "parameters.csv"),
          row.names=T)

print(Parameters)






# 3.3. Safety Check


# Ensures that protein_mat rownames match patient_id column in patient_info
all(rownames(protein_mat) == patient_info$patient_id)  # Should return TRUE

any(is.na(match(patient_info$patient_id, 
                rownames(protein_mat_ALL))))  # Should return FALSE

# Ensures that protein_mat rownames match patient_id column in patient_info
all(rownames(protein_mat) == patient_info$patient_id)  # Should return TRUE






```
